define(`codeblock',`include(tmp/$1.html)dnl')
changequote(<{!,!}>)dnl
<!DOCTYPE html>
<meta charset="utf-8">
<meta name="viewport" content="width=1024, height=768, user-scalable=no">

<title>Sheaves in Lean - Lean Together 2019</title>

<link rel="stylesheet" media="screen" href="css/reset.css">
<link rel="stylesheet" media="screen" href="css/fira_code.css">
<link rel="stylesheet" media="screen" href="css/pygments.css">
<link rel="stylesheet" media="screen" href="css/generic.css">
<link rel="stylesheet" media="screen" href="css/special.css">

<link rel="stylesheet" media="screen" href="css/stack.v0.css">

<section id="titleslide">
	<h1>Sheaves in Lean</h1>
<footer><span id="wip">[work in progress]</span>
	<span id="author"><em>by</em> &emsp; Johan Commelin</span></footer>
</section>

<section>
<center>
	<img src="sheaf.jpg" id="sheaf-pic" />
</center>
<footer><span class="credit tiny">
	(Image source:
	<a href="https://clipground.com/images/barley-clipart-20.jpg">
	https://clipground.com/images/barley-clipart-20.jpg</a>)
</span></footer>
</section>

<section>
<center class="huge">
<code class="highlight">
	<span class="n">X</span>
	<span class="bp">→</span>
	<span class="n">ℝ</span>
</code>
</center>
</section>

<section>
<center>
	functions glue uniquely
</center>
</section>

<section>
<div class="vcenter">
<p>A <em>presheaf</em> <code>F</code>
is a rule that assigns
<ul>
<li class="step">to every open <code>U ⊆ X</code><br/>
a set
<code class="highlight"><span class="n">F</span><span class="o">(</span><span class="n">U</span><span class="o">)</span></code>
<code class="tiny marginal highlight"><span class="c">-- functions</span></code>
</li>
<li class="step">to every inclusion of opens <code>U ⊆ V</code><br/>
a map
<code class="highlight">
<span class="n">r_UV</span> <span class="o">:</span>
<span class="n">F</span><span class="o">(</span><span class="n">V</span><span class="o">)</span>
<span class="bp">→</span>
<span class="n">F</span><span class="o">(</span><span class="n">U</span><span class="o">)</span>
</code>
<code class="tiny marginal highlight"><span class="c">-- restriction</span></code>
</li>
</ul>
<p>such that
<ul>
<li class="step">for every open <code>U ⊆ X</code>,<br/>
the map <code>r_UU</code> is <code>id</code> on
<code class="highlight"><span class="n">F</span><span class="o">(</span><span class="n">U</span><span class="o">)</span></code></li>
<li class="step">and if <code>U ⊆ V ⊆ W</code>,<br/>
then
<code class="highlight"><span class="n">r_UV</span> <span class="err">∘</span> <span class="n">r_VW</span>
	<span class="bp">=</span> <span class="n">r_UW</span></code>.</li>
</ul>
</div>
</section>

<section>
<div class="vcenter">
codeblock(psh_as_func)
</div>
</section>

<section id="categories">
<h2>Categories in Lean</h2>
<div class="tiny vcenter">
codeblock(category)
</div>
<footer><span class="credit">(by Scott Morrison)</span></footer>

</section>

<section>
<div class="tiny vcenter">
codeblock(functor)
</div>
<footer><span class="credit">(by Scott Morrison)</span></footer>
</section>

<section>
<div class="tiny vcenter">
codeblock(types_and_yoneda)
</div>
<footer><span class="credit">(by Scott Morrison)</span></footer>
</section>

<section>
<div class="tiny vcenter">
codeblock(yoneda_terse)
</div>
<footer><span class="credit">(by Scott Morrison)</span></footer>
</section>

<section>
<h2>So, what is a sheaf?</h2>
<p>Let <code>U_i ⊆ X</code> be open sets that cover <code>U ⊆ X</code>.</p>
<div class="step">
<p>Consider the following set</p>
<div class="small">
codeblock(sheaf_condition)
</div>
</div>
<div class="step">
<p>There is a canonical map
<code class="highlight">
	<span class="n"><span class="n">F</span><span class="o">(</span><span class="n">U</span><span class="o">)</span> <span class="bp">→</span> <span class="n">F'</span><span class="o">(</span><span class="n">U</span><span class="o">)</span>
</code>
</p>
</div>
<div class="step">
<p>A presheaf <code>F</code> is called a <em>sheaf</em>
	if this canonical map is bijective for every <code>U ⊆ X</code>
	and every cover of <code>U</code>.
</div>
</section>

<section>
<h2>Goals</h2>
What's on my horizon:
<ul>
	<li class="step">Sheaves for schemes and perfectoid spaces</li>
	<li class="step">Sheaves on a basis</li>
	<li class="step">&Eacute;tale topology</li>
	<li class="step">Sites, topoi</li>
	<li class="step">Preparations for sheaf cohomology</li>
</ul>
</section>

<section>
<h2>Status</h2>
Where I am right now:
<ul>
	<li class="step">Testing limits/colimits in mathlib</li>
	<li class="step">Writing categorical boilerplate</li>
	<li class="step">Hesitating about design decisions</li>
	<li class="step">Sites, pretopologies, coverages, Grothendieck topologies</li>
	<li class="step">Alas, Lean does not know an example of a sheaf (yet)</li>
</ul>
</section>

<!-- <script src="js/mermaid.min.js"></script> -->
<!-- <script>mermaid.initialize({ -->
<!-- 	startOnLoad:true -->
<!-- });</script> -->

<script src="js/d3.v3.min.js"></script>
<script src="js/quack.v1.js"></script>

<script>
var myquack = quack()
.on("activate", activate)
.on("deactivate", deactivate);

var section = d3.selectAll("section");
section.selectAll(".step").style("visibility", "hidden");

myquack.index = 0;
var stepctr = {};
myquack.cur = section[0][0];

function inc_step() {
	var steps = myquack.cur.selectAll(".step")
	if (myquack.index in stepctr) {
		stepctr[myquack.index] += 1;
	} else {
		stepctr[myquack.index] = 0;
	}
	if (stepctr[myquack.index] >= steps[0].length) {
		stepctr[myquack.index] = steps[0].length - 1;
	}
	steps.filter(
		function (d, idx) { return idx === stepctr[myquack.index]; }
	).style("visibility", "visible");
}
function dec_step() {
	var steps = myquack.cur.selectAll(".step")
	if (myquack.index in stepctr) {
		stepctr[myquack.index] -= 1;
	} else {
		stepctr[myquack.index] = steps[0].length - 1;
	}
	if (stepctr[myquack.index] < -1) {
		stepctr[myquack.index] = -1;
	}
	myquack.cur.selectAll(".step").filter(
		function (d, idx) { return idx === stepctr[myquack.index] + 1; }
	).style("visibility", "hidden");
}

d3.select(window).on("keydown", function () {
	if (d3.event.keyCode === 74) {
		inc_step();
	}
	if (d3.event.keyCode === 75) {
		dec_step();
	}
} );

function activate(d, i) {
	myquack.index = i;
	myquack.cur = section.filter(
		function (d, idx) { return idx === myquack.index; }
	);
	console.log(myquack.cur.selectAll(".step"));
}

function deactivate(d, i) {
}
</script>
